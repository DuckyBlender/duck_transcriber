name: Rust

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  CARGO_TERM_COLOR: always

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Install dependencies
              run: sudo apt-get install -y libssl-dev pkg-config
            - name: Install Rust toolchain
              uses: dtolnay/rust-toolchain@stable
            - name: Install Zig toolchain
              uses: korandoru/setup-zig@v1
              with:
                zig-version: 0.10.0
            - name: Install Cargo Lambda
              uses: jaxxstorm/action-install-gh-release@v1.9.0
              with:
                repo: cargo-lambda/cargo-lambda
                platform: linux
                arch: aarch64
            - name: Compile Rust code
              run: cargo lambda build --release --arm64
            # - name: Upload Lambda (maybe later i dont like this rn)
            #   run: cargo lambda deploy
